<!DOCTYPE html>
 <html>
   <head>
     <!--Import Google Icon Font-->
     <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
     <!--Import materialize.css-->
     <link type="text/css" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.6/css/materialize.min.css"  media="screen,projection"/>

     <!--Let browser know website is optimized for mobile-->
     <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
     <nav>
    <div class="nav-wrapper blue lighten-2">
      &nbsp;&nbsp;&nbsp;&nbsp;<a href="/" class="brand-logo">sb2Edit</a>
      <ul id="nav-mobile" class="right hide-on-med-and-down">
        <li><a href="/edit/">Editor</a></li>
        <li><a href="https://github.com/scratchyone/sb2edit/tree/gh-pages">Github</a></li>
      </ul>
    </div>
  </nav>
  <script>
    var qs = (function(a) {
    if (a == "") return {};
    var b = {};
    for (var i = 0; i < a.length; ++i)
    {
        var p=a[i].split('=', 2);
        if (p.length == 1)
            b[p[0]] = "";
        else
            b[p[0]] = decodeURIComponent(p[1].replace(/\+/g, " "));
    }
    return b;
})(window.location.search.substr(1).split('&'));
projectId=qs["url"]
projectId = projectId.replace("://scratch.mit.edu/projects/", "").replace("https", "").replace("http", "");
  projectId = parseInt(projectId);
  if(isNaN(projectId)){
    var myCodeMirror = CodeMirror(document.body, {
    value: "ERROR: INVALID URL",
    mode:  "javascript"
  });
  }
  window.onload = function() {
    fetch("https://crossorigin.me/https://cdn.projects.scratch.mit.edu/internalapi/project/"+projectId+"/get/")
  .then(function(response) {
    response.text().then(function(text) {
        var myCodeMirror = CodeMirror(codemirroreditor, {
        value: text,
        mode:  {name: "javascript", json: true},
      });});
  })
}
  </script>
  <style>
        .CodeMirror {
          border: 1px solid #eee; !important
          height: 500px; !important
        }

  </style>
  </head>
  <body style="height: 100%; width: 100%;">
    <div style="height: 100%; width: 100%;" id="codemirroreditor">

    </div>
    <script src="https://cdn.rawgit.com/codemirror/CodeMirror/master/lib/codemirror.js"></script>
<link rel="stylesheet" href="https://cdn.rawgit.com/codemirror/CodeMirror/master/lib/codemirror.css">
<script src="https://cdn.rawgit.com/codemirror/CodeMirror/master/mode/javascript/javascript.js"></script>
    <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.6/js/materialize.min.js"></script>
  </body>
  </html>
